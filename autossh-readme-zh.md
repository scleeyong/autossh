# autossh 版本 1.4
-------------------

# 构建和安装 Autossh
--------------------

从 1.4 版本开始，autossh 现在使用 autoconf。因此，构建过程现在是众所周知的：

	./configure
	make
	make install

请查看 autossh.host 文件以获取一个示例的包装脚本。

# 用法
-----
	autossh -M <port>[:echo_port] [-f] [SSH OPTIONS]
  
# 描述
autossh 是一个启动 ssh 的程序，并监控它，如果它死掉或停止传输流量，会重新启动它。

最初的想法和机制来自 rstunnel（可靠的 SSH 隧道）。在 1.2 版本中，方法发生了变化：autossh 现在使用 ssh 构建一个 SSH 转发的循环（从本地到远程，从远程到本地），然后发送测试数据，并期望收到回应。（这个想法要感谢 Terrence Martin。）

在 1.3 版本中，增加了一种新的方法（感谢 Ron Yorston）：可以指定一个远程回显服务的端口，该服务将回显测试数据。这避免了担心远程机器上的所有端口号冲突的拥堵和麻烦。当无法使用回显服务时，仍然可以使用循环转发的方法。

autossh 有三个自己的参数：

 -M <port>[:echo_port]，用于指定要使用的基本监视端口，或者可以选择指定监视端口和回显服务端口。
  
	当没有指定回显服务端口时，这个端口和它的上一个端口（port# + 1）不应该被其他进程使用。autossh会在基本监视端口上发送测试数据，并在上一个端口上接收返回的数据。例如，如果你指定"-M 20000"，autossh将设置转发，使其可以在端口20000上发送数据，并在20001上接收返回的数据。
	另外，可以指定一个远程回显服务的端口。如果想使用标准的inetd回显服务，这个端口应该是端口7。当指定了回显端口时，只使用指定的监视端口，并且在两个方向上传递监视消息。
	许多人禁用了回显服务，甚至禁用了inetd，所以请确保远程机器上可用该服务。有些操作系统允许指定该服务只监听本地主机（环回接口），这对于此用途足够。
	回显服务也可以是更复杂的东西：比如监控一组SSH隧道的守护进程。
	-M 0 将关闭监视功能，autossh只会在SSH退出时重新启动SSH。
	例如，如果你使用的是最近版本的OpenSSH，你可能希望尝试使用ServerAliveInterval和ServerAliveCountMax选项，使SSH客户端在发现与服务器断开连接时退出。在许多方面，这可能是比监视端口更好的解决方案。

 -f     
  在运行ssh之前，导致autossh进入后台运行。-f标志将从传递给ssh的参数中去除。需要注意的是，autossh中的-f与ssh中的-f存在一个重要的区别：当与autossh一起使用时，ssh将无法要求输入密码或密钥密码。使用-f时，"starting gate"时间（参见AUTOSSH_GATETIME）将被设置为0。

 -V     
  使autossh显示其版本号并退出。
  
autossh会将所有其他参数传递给ssh。还有一些其他的设置，但这些都是通过环境变量控制的。ssh似乎在为选项占用越来越多的字母，这似乎是避免冲突的最简单方法。

autossh尝试区分它监视的ssh进程的退出方式，并采取相应的行动。规则如下：

如果ssh进程正常退出（例如，某人在交互会话中输入"exit"），autossh将退出而不是重新启动；
如果autossh本身收到SIGTERM、SIGINT或SIGKILL信号，它会认为这是有意地发送的信号，并在杀死子ssh进程后退出；
如果autossh本身收到SIGUSR1信号，它将杀死子ssh进程并启动一个新的进程；
定期（默认为每10分钟）autossh尝试在监视转发端口上传递流量。如果失败，autossh将杀死子ssh进程（如果它仍在运行）并启动一个新的进程；
如果子ssh进程以其他任何原因死亡，autossh将尝试启动一个新的进程。
  
  
  
  
  
  
